<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Reconnaissance de chiffres</title>
  <style>
    body { text-align: center; font-family: Arial; }
    canvas { border: 1px solid black; cursor: crosshair; }
    #result { font-size: 24px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Reconnaissance de chiffres (MNIST simplifié)</h1>
  <canvas id="canvas" width="280" height="280"></canvas><br>
  <button onclick="clearCanvas()">Effacer</button>
  <button onclick="predict()">Prédire</button>
  <div id="result">Dessine un chiffre puis clique sur "Prédire"</div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    ctx.lineWidth = 20;
    ctx.lineCap = "round";
    let drawing = false;

    canvas.addEventListener("mousedown", () => drawing = true);
    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mousemove", draw);

    function draw(e) {
      if (!drawing) return;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      document.getElementById("result").textContent = "Dessine un chiffre puis clique sur 'Prédire'";
    }

    // === Ici tu colles les poids du site UCSD ===
    var weightsHidden = [/* ... colle ici ton gros tableau ... */];
    var weightsOutput = [/* ... colle ici ton autre gros tableau ... */];

    function sigmoid(x) {
      return 1 / (1 + Math.exp(-x));
    }

    function predict() {
      // Récupère l'image 28x28
      let img = ctx.getImageData(0, 0, 280, 280);
      let input = [];
      for (let y = 0; y < 28; y++) {
        for (let x = 0; x < 28; x++) {
          let px = ctx.getImageData(x*10, y*10, 10, 10).data;
          let sum = 0;
          for (let i = 0; i < px.length; i+=4) sum += px[i+3]; // alpha comme intensité
          input.push(sum/2550); // normalisation approx
        }
      }

      // Passe avant : input -> hidden
      let hidden = [];
      for (let j = 0; j < 30; j++) {
        let sum = 0;
        for (let i = 0; i < 784; i++) {
          sum += input[i] * weightsHidden[j*784 + i];
        }
        hidden[j] = sigmoid(sum);
      }

      // Passe sortie
      let output = [];
      for (let k = 0; k < 10; k++) {
        let sum = 0;
        for (let j = 0; j < 30; j++) {
          sum += hidden[j] * weightsOutput[k*30 + j];
        }
        output[k] = sigmoid(sum);
      }

      // Trouver la classe max
      let prediction = output.indexOf(Math.max(...output));
      document.getElementById("result").textContent = "Prédiction : " + prediction;
    }
  </script>
</body>
</html>
